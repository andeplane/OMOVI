{"version":3,"sources":["FileUpload.tsx","PlayControls.tsx","SimulationDataVisualizer.tsx","App.tsx","hooks/simulation.ts","index.tsx","../../src/core/materials.ts","../../src/OMOVIVisualizer.tsx","../../src/core/visualizer.ts","../../src/core/geometries/particles/particles.ts","../../src/core/geometries/particles/shaders/fragment.ts","../../src/core/geometries/bonds/bonds.ts","../../src/core/geometries/bonds/shaders/fragment.ts","../../src/core/atomtypes.ts","../../src/core/simulationdata/simulationdata.ts","../../src/core/simulationdata/simulationcell.ts","../../src/core/simulationdata/simulationdataframe.ts","../../src/parsers/xyzparser.ts","../../src/parsers/lammpsbinarydumpparser.ts","../../src/parsers/lammpsdataparser.ts","../../src/utils/kdtree/binary-heap.ts","../../src/utils/kdtree/kdtree.ts","../../src/utils/bondcreators.ts"],"names":["FileUpload","onFileUploaded","domElement","useRef","showDropZone","useCallback","current","style","display","hideDropZone","allowDrag","e","dataTransfer","dropEffect","preventDefault","handleDrop","a","files","length","filename","name","endsWith","arrayBuffer","buffer","text","useEffect","window","addEventListener","ref","className","id","Container","styled","div","PlayControls","numFrames","onFrameChanged","playing","useState","isPlaying","setIsPlaying","frame","setFrame","mouseDown","setMouseDown","onFrameChangedCB","toggleIsPlaying","handleMouseDown","onMouseUp","ev","removeEventListener","handleKeyDown","keyCode","interval","setInterval","nextFrame","clearInterval","height","placement","closable","visible","mask","flex","onMouseDown","onClick","console","log","defaultValue","max","value","onChange","PauseOutlined","fontSize","CaretRightOutlined","SimulationDataVisualizer","simulationData","cameraTarget","setCameraTarget","cameraPosition","setCameraPosition","simulationCell","frames","center","getCenter","boundingBox","getBoundingBox","position","clone","add","sub","multiplyScalar","currentFrame","getFrame","particles","bonds","getNumFrames","newFrame","Header","Layout","Content","Sider","SubMenu","Menu","waterUrl","ljUrl","App","setSimulationData","fileName","setFileName","url","setUrl","loading","loadSimulation","onFileLoaded","fetch","file","useLoadSimulation","contents","parseXyz","parseLAMMPSData","parseLAMMPSBinaryDump","loadWater","onWaterUploaded","createBondsFunction","createBondsByDistance","radius","pairDistances","type1","type2","distance","generateBondsFunction","loadLJ","simulationUrl","URLSearchParams","location","search","get","defaultSelectedKeys","undefined","minHeight","theme","defaultOpenKeys","mode","key","icon","DotChartOutlined","title","Item","padding","left","width","CopyOutlined","fullUrl","toString","replace","encode","navigator","clipboard","writeText","message","info","copyUrl","ReactDOM","render","document","getElementById","constructor","materialType","parameters","copy","THREE","castedSource","this","material","Material","materialMap","createMaterial","type","color","_fragDepthSupported","renderer","gl","fragDepthSupported","shader","Object","inverseModelMatrix","modelViewMatrix","normalMatrix","inverseNormalMatrix","Visualizer","object","remove","setupLights","ambientLight","directionalLight","scene","setupCanvas","canvas","setupCamera","camera","updateUniforms","dispose","getCameraPosition","getCameraTarget","target","animate","requestAnimationFrame","resizeIfNeeded","rendererSize","rendererPixelWidth","rendererPixelHeight","clientWidth","clientHeight","clientPixelWidth","clientPixelHeight","clientTextureSize","scale","Math","adjustCamera","cpuStats","memoryStats","OMOVIVisualizer","newVisualizer","setVisualizer","prevParticlesRef","prevParticles","prevBondsRef","prevBonds","visualizer","capacity","getRadius","index","getPosition","getType","getGeometry","baseGeometry","geometry","getMesh","matrix","i","markNeedsUpdate","attribute","Float32Array","r","g","b","count","getPosition1","positions","positionBufferAttribute","indexBufferAttribute","Uint16Array","colors","getColor","particleType","AtomTypes","H","shortname","fullname","He","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr","Rb","Sr","Y","Zr","Nb","Mo","Tc","Ru","Rh","Pd","Ag","Cd","In","Sn","Sb","Te","I","Xe","Cs","Ba","La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu","Hf","Ta","W","SimulationData","SimulationCell","vector1","vector2","vector3","origin","getOrigin","box","SimulationDataFrame","generateSimulationCell","size","particleTypeMap","addParticlesToFrame","lines","j","lineData","element","atomType","x","parseFloat","y","z","data","numLines","skipNextLine","readNumParticles","numParticles","parseInt","isNaN","Particles","parseHeader","offset","triclinicParser","noParser","ipHeader","tag","choices","1","0","parseFrame","header","Number","chunkIndex","chunkParser","chunk","particleIndex","typeStr","xy","xz","yz","simulationDataFrame","parse","mainBuffer","Buffer","response","ensureNotNull","values","ParseError","lineNumber","findNext","line","callback","needle","numAtoms","xlo","xhi","ylo","yhi","zlo","zhi","getNextLineNumber","isMolecular","molId","parseMolecular","parseAtomic","scoreFunction","content","push","pop","result","end","peek","len","Error","bubbleUp","n","parentN","parent","sinkDown","elemScore","child1Score","child2N","child1N","swap","child1","child2","child2Score","reusableArray","points","metric","maxDepth","currentNode","indices","Uint32Array","Int32Array","buildTree","depth","plength","arrEnd","nodeIndex","nodes","arrMedian","arrBegin","currentDim","right","pivotValue","pivotIndex","tmp","storeIndex","getNodeDepth","parentIndex","nearest","bestNodes","BinaryHeap","nearestSearch","dimension","pointIndex","ownPoint","ownDistance","leftIndex","rightIndex","bestChild","point","saveNode","linearPoint","linearDistance","otherChild","il","verify","dim","pairDistancesMap","pairDistance","pairs","tree","Kdtree","position1","position2","particle1Type","particle2Type","distanceThreshold","pairKey","Bonds"],"mappings":"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","file":"static/js/main.b199ea13.chunk.js","sourcesContent":["import React, { useRef, useEffect, useCallback } from 'react'\n// Based on https://codepen.io/nekobog/pen/JjoZvBm\ninterface FileUploadProps {\n    onFileUploaded: (filename: string, text?: string, buffer?: ArrayBuffer) => void\n}\nconst FileUpload = ({ onFileUploaded }: FileUploadProps) => {\n    const domElement = useRef<HTMLDivElement | null>(null);\n\n    const showDropZone = useCallback(() => {\n        if (domElement.current) {\n            domElement.current.style.display = \"block\";\n        }\n    }, [])\n\n    const hideDropZone = useCallback(() => {\n        if (domElement.current) {\n            domElement.current.style.display = \"none\";\n        }\n    }, [])\n\n    const allowDrag = useCallback((e: DragEvent) => {\n        if (true) {  // Test that the item being dragged is a valid one\n            e.dataTransfer!.dropEffect = 'copy';\n            e.preventDefault();\n        }\n    }, [])\n\n    const handleDrop = useCallback(async (e: DragEvent) => {\n        e.preventDefault();\n        hideDropZone();\n        const files = e.dataTransfer?.files\n        if (files && files.length > 0) {\n            const filename = files[0].name\n            let text, buffer;\n            if (filename.endsWith('.bin')) {\n                buffer = await files[0].arrayBuffer()\n            } else {\n                text = await files[0].text()\n            }\n            onFileUploaded(filename, text, buffer)\n        }\n\n    }, [hideDropZone, onFileUploaded])\n\n    useEffect(() => {\n        if (domElement.current) {\n            window.addEventListener('dragenter', function (e) {\n                showDropZone();\n            });\n\n            domElement.current.addEventListener('dragenter', allowDrag);\n            domElement.current.addEventListener('dragover', allowDrag);\n\n            domElement.current.addEventListener('dragleave', function (e) {\n                hideDropZone();\n            });\n\n            domElement.current.addEventListener('drop', handleDrop);\n        }\n\n    }, [allowDrag, domElement, handleDrop, hideDropZone, showDropZone])\n\n    return (\n        <div ref={domElement} className=\"dropzone\" id=\"dropzone\" />\n    )\n}\n\nexport default FileUpload","import React, { useState, useCallback, useEffect } from 'react'\nimport { Drawer, Slider, Row, Col } from 'antd'\nimport { CaretRightOutlined, PauseOutlined } from '@ant-design/icons'\nimport styled from 'styled-components';\n\nconst Container = styled.div`\n.ant-slider-handle {\n  width: 25px;\n  height: 25px;\n  transform: translateY(-25%); !important\n}\n`\n\nconst PlayControls = ({ numFrames, onFrameChanged, playing }: { numFrames: number, playing: boolean, onFrameChanged: (frame: number) => void }) => {\n  const [isPlaying, setIsPlaying] = useState(playing)\n  const [frame, setFrame] = useState(0)\n  const [mouseDown, setMouseDown] = useState(false)\n\n  const onFrameChangedCB = useCallback((frame: number) => {\n    setFrame(frame)\n    onFrameChanged(frame)\n  }, [onFrameChanged])\n\n  const toggleIsPlaying = useCallback(() => {\n    setIsPlaying(!isPlaying)\n  }, [isPlaying])\n\n  const handleMouseDown = useCallback(() => {\n    setMouseDown(true)\n    const onMouseUp = (ev: MouseEvent) => {\n      setMouseDown(false)\n      window.removeEventListener('mouseup', onMouseUp)\n    }\n    window.addEventListener('mouseup', onMouseUp)\n  }, [])\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.keyCode === 32) {\n        // Handle space\n        setIsPlaying(!isPlaying)\n      }\n\n    }\n    window.addEventListener('keydown', handleKeyDown)\n\n    return () => { window.removeEventListener('keydown', handleKeyDown) }\n  }, [isPlaying])\n\n  useEffect(() => {\n    if (!mouseDown && isPlaying) {\n      const interval = setInterval(() => {\n        let nextFrame = frame + 1\n        if (nextFrame >= numFrames) {\n          nextFrame = 0\n        }\n        setFrame(nextFrame)\n        onFrameChanged(nextFrame)\n      }, 20);\n\n      return () => clearInterval(interval);\n    }\n    return () => { }\n  }, [frame, isPlaying, numFrames, onFrameChanged, mouseDown]);\n\n  return (\n    <Drawer\n      height={\"5em\"}\n      placement={\"bottom\"}\n      closable={false}\n      visible={true}\n      mask={false}\n    >\n      <Row>\n        <Col flex=\"10em\">\n          {frame} / {numFrames}\n        </Col>\n        <Col flex=\"auto\">\n          <Container onMouseDown={handleMouseDown} onClick={(e) => { console.log(\"Clicked\") }}>\n            <Slider defaultValue={frame} max={numFrames - 1} value={frame} onChange={onFrameChangedCB} />\n          </Container>\n        </Col>\n        <Col flex=\"3em\">\n          {isPlaying ? <PauseOutlined onClick={toggleIsPlaying} style={{ fontSize: '2em' }} /> : <CaretRightOutlined onClick={toggleIsPlaying} style={{ fontSize: '2em' }} />}\n        </Col>\n      </Row>\n    </Drawer>\n  )\n}\n\nexport default PlayControls","import React, { useEffect, useState } from 'react'\nimport * as THREE from 'three'\n\nimport { OMOVIVisualizer, SimulationData } from 'omovi'\nimport PlayControls from './PlayControls'\n\n// const createBondsFunction = createBondsByDistance({radius: 0.5, pairDistances: [{type1: 'H', type2: 'O', distance: 1.4}]})\ninterface SimulationDataVisualizerProps {\n  simulationData?: SimulationData\n}\nconst SimulationDataVisualizer = ({ simulationData }: SimulationDataVisualizerProps) => {\n  const [frame, setFrame] = useState<number>(0)\n  const [cameraTarget, setCameraTarget] = useState<THREE.Vector3>()\n  const [cameraPosition, setCameraPosition] = useState<THREE.Vector3>()\n\n  useEffect(() => {\n    if (simulationData != null) {\n      // simData.generateBondsFunction = createBondsFunction\n      setFrame(0)\n      const simulationCell = simulationData.frames[0].simulationCell\n      const center = simulationCell.getCenter()\n      const boundingBox = simulationCell.getBoundingBox()\n\n      setCameraTarget(center)\n\n      const position = center.clone().add(boundingBox.max.clone().sub(center).multiplyScalar(3.5))\n      setCameraPosition(position)\n      setCameraTarget(simulationData.frames[0].simulationCell.getCenter())\n    }\n  }, [simulationData])\n\n  if (simulationData == null) {\n    return <>Downloading simulation data ...</>\n  }\n\n  const currentFrame = simulationData.getFrame(frame)\n  if (currentFrame == null) {\n    return <>No simulation data ...</>\n  }\n\n  const onFrameChanged = (newFrame: number) => {\n    setFrame(newFrame)\n  }\n\n  return (\n    <>\n      <OMOVIVisualizer particles={currentFrame.particles} bonds={currentFrame.bonds} cameraTarget={cameraTarget} cameraPosition={cameraPosition} />\n      <PlayControls numFrames={simulationData.getNumFrames()} onFrameChanged={onFrameChanged} playing={true} />\n    </>\n  )\n}\n\nexport default SimulationDataVisualizer\n","import React, { useEffect, useCallback, useState } from 'react'\n\nimport 'antd/dist/antd.css'\n//@ts-ignore\nimport encode from 'strict-uri-encode'\nimport { Layout, Menu, message } from 'antd';\nimport {\n  DotChartOutlined,\n  CopyOutlined\n} from '@ant-design/icons';\n\nimport FileUpload from './FileUpload'\n\nimport { createBondsByDistance, SimulationData, parseXyz, parseLAMMPSData, parseLAMMPSBinaryDump } from 'omovi'\nimport SimulationDataVisualizer from './SimulationDataVisualizer'\nimport { useLoadSimulation } from 'hooks/simulation'\n\nconst { Header, Content, Sider } = Layout;\nconst { SubMenu } = Menu;\n\nconst waterUrl = \"https://raw.githubusercontent.com/andeplane/simulations/main/water.xyz\"\nconst ljUrl = \"https://raw.githubusercontent.com/andeplane/simulations/main/lj.xyz\"\n\nconst App = () => {\n  const [simulationData, setSimulationData] = useState<SimulationData>()\n  const [fileName, setFileName] = useState<string>()\n  const [url, setUrl] = useState<string>()\n  const { loading, loadSimulation } = useLoadSimulation()\n\n  const onFileUploaded = useCallback((fileName: string, contents?: string, buffer?: ArrayBuffer) => {\n    setFileName(fileName)\n    let simulationData;\n    if (fileName.endsWith('xyz')) {\n      simulationData = parseXyz(contents)\n    } else if (fileName.endsWith('data')) {\n      simulationData = parseLAMMPSData(contents)\n    } else if (fileName.endsWith('bin')) {\n      simulationData = parseLAMMPSBinaryDump(buffer)\n    }\n\n    setSimulationData(simulationData)\n  }, [])\n\n  const loadWater = useCallback(() => {\n    const onWaterUploaded = async (fileName: string, contents?: string, buffer?: ArrayBuffer) => {\n      const createBondsFunction = createBondsByDistance({ radius: 0.5, pairDistances: [{ type1: 'H', type2: 'O', distance: 1.4 }] })\n      const simulationData = parseXyz(contents)\n      simulationData.generateBondsFunction = createBondsFunction\n      setFileName(fileName)\n      setSimulationData(simulationData)\n    }\n    setUrl(waterUrl)\n    loadSimulation(waterUrl, onWaterUploaded)\n  }, [loadSimulation])\n\n  const loadLJ = useCallback(() => {\n    setUrl(ljUrl)\n    loadSimulation(ljUrl, onFileUploaded)\n  }, [loadSimulation, onFileUploaded])\n\n  const urlParams = new URLSearchParams(window.location.search)\n  const simulationUrl = urlParams.get('url')\n\n  useEffect(() => {\n    if (simulationUrl != null && simulationUrl !== url) {\n      setUrl(simulationUrl)\n      loadSimulation(simulationUrl, onFileUploaded)\n    }\n  }, [loadSimulation, onFileUploaded, simulationUrl, url])\n\n  useEffect(() => {\n    if (simulationData == null && simulationUrl == null) {\n      loadWater()\n    }\n  }, [simulationData, onFileUploaded, loadSimulation, loadWater, simulationUrl])\n\n  const renderHeader = () => {\n    const copyUrl = () => {\n      const currentUrlWithoutQueryParams = window.location.toString().replace(window.location.search, \"\")\n      const fullUrl = currentUrlWithoutQueryParams + '?url=' + encode(url)\n      navigator.clipboard.writeText(fullUrl)\n      message.info(\"Copied simulation link to clipboard\")\n    }\n    if (loading) {\n      return <h2>Downloading simulation ...</h2>\n    }\n\n    if (url) {\n      return (<h2>{fileName} &nbsp; <CopyOutlined title=\"Copy link to this simulation\" onClick={() => copyUrl()} /></h2>)\n    } else {\n      return (<h2>{fileName}</h2>)\n    }\n  }\n\n  const defaultSelectedKeys = simulationUrl === undefined ? ['example1'] : undefined\n\n  return (\n    <Layout style={{ minHeight: '100vh' }}>\n      <Sider>\n        <div className=\"logo\" />\n        <Menu theme=\"dark\" defaultOpenKeys={[\"examples\"]} defaultSelectedKeys={defaultSelectedKeys} mode=\"inline\">\n          <SubMenu key=\"examples\" icon={<DotChartOutlined />} title=\"Examples\">\n            <Menu.Item key=\"example1\" onClick={() => loadWater()} icon={<DotChartOutlined />}>\n              Water molecule\n            </Menu.Item>\n            <Menu.Item key=\"example2\" onClick={() => loadLJ()} icon={<DotChartOutlined />}>\n              LJ liquid\n          </Menu.Item>\n          </SubMenu>\n        </Menu>\n      </Sider>\n      <Layout className=\"site-layout\">\n        <Header className=\"site-layout-background\" style={{ padding: 0, position: 'absolute', left: 200, width: '100%' }}>\n          {renderHeader()}\n        </Header>\n        <Content>\n          <SimulationDataVisualizer simulationData={simulationData} />\n          <FileUpload onFileUploaded={onFileUploaded} />\n        </Content>\n      </Layout>\n    </Layout>\n  )\n}\n\nexport default App\n","\nexport const useLoadSimulation = () => {\n  let loading: boolean = false\n  const loadSimulation = async (url: string, onFileLoaded: (fileName: string, contents?: string, buffer?: ArrayBuffer) => void) => {\n    loading = true\n    const file = await fetch(url)\n    let text, buffer\n    if (url.endsWith('.bin')) {\n      buffer = await file.arrayBuffer()\n    } else {\n      text = await file.text()\n    }\n    loading = false\n    onFileLoaded(url, text, buffer)\n  }\n  return { loading, loadSimulation }\n}","import './index.css'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n","import * as THREE from 'three'\n\nexport interface Uniforms {\n  [name: string]: THREE.IUniform\n}\n\nexport interface Extensions {\n  fragDepth?: boolean\n}\n\nclass Material extends THREE.MeshPhongMaterial {\n  materialType: string\n  uniforms: Uniforms\n  extensions: Extensions\n\n  constructor(\n    materialType: string,\n    parameters?: THREE.MeshPhongMaterialParameters\n  ) {\n    super(parameters)\n    // @ts-ignore\n    this.materialType = materialType\n    this.uniforms = {}\n    this.extensions = {}\n    this.defines = {}\n  }\n\n  copy(source: THREE.Material): this {\n    THREE.MeshPhongMaterial.prototype.copy.call(this, source)\n    const castedSource = source as Material\n    this.type = castedSource.type\n    this.defines = { ...castedSource.defines }\n    this.extensions = castedSource.extensions\n    this.uniforms = castedSource.uniforms\n    this.onBeforeCompile = castedSource.onBeforeCompile\n    return this\n  }\n\n  clone(): this {\n    // three.js uses \"this\" for no good reason, and we need to match that\n    const material = new THREE.MeshPhongMaterial()\n    Material.prototype.copy.call(material, this)\n    return material as this\n  }\n}\n\nconst materialMap: { [key: string]: Material } = {}\nlet _fragDepthSupported: boolean | undefined\n\nfunction fragDepthSupported() {\n  if (_fragDepthSupported !== undefined) {\n    return _fragDepthSupported\n  }\n\n  const renderer = new THREE.WebGLRenderer()\n  const gl = renderer.domElement.getContext('webgl')\n\n  if (\n    renderer.capabilities.isWebGL2 ||\n    (gl != null && gl.getExtension('EXT_frag_depth') != null)\n  ) {\n    _fragDepthSupported = true\n  } else {\n    _fragDepthSupported = false\n  }\n\n  renderer.dispose()\n\n  return _fragDepthSupported\n}\n\nconst createMaterial = (\n  type: string,\n  vertexShader: string,\n  fragmentShader: string\n) => {\n  if (materialMap[type] != null) {\n    return materialMap[type]\n  }\n\n  const material = new Material(type, { color: 0xffffff })\n  material.uniforms.inverseModelMatrix = { value: new THREE.Matrix4() }\n  material.uniforms.inverseNormalMatrix = { value: new THREE.Matrix3() }\n\n  if (fragDepthSupported()) {\n    material.extensions.fragDepth = true\n    material.defines!.FRAG_DEPTH = 1\n  }\n\n  material.onBeforeCompile = (shader: THREE.Shader) => {\n    Object.assign(shader.uniforms, material.uniforms)\n    material.uniforms = shader.uniforms\n\n    shader.vertexShader = vertexShader\n    shader.fragmentShader = fragmentShader\n  }\n\n  // Necessary because of a bug in THREE.JS\n  // https://github.com/mrdoob/three.js/issues/15948\n  material.onBeforeCompile.toString = () => type\n\n  materialMap[type] = material\n  return material\n}\n\nexport default createMaterial\nexport { Material }\n","import React, { useEffect, useState, useRef } from 'react'\nimport Visualizer from './core/visualizer'\nimport Particles from './core/geometries/particles/particles'\nimport Bonds from './core/geometries/bonds/bonds'\n\nlet newVisualizer: Visualizer | undefined\n\nconst OMOVIVisualizer = ({\n  particles,\n  bonds,\n  cameraTarget,\n  cameraPosition\n}: {\n  particles?: Particles\n  bonds?: Bonds\n  cameraTarget?: THREE.Vector3\n  cameraPosition?: THREE.Vector3\n}) => {\n  const domElement = useRef<HTMLDivElement | null>(null)\n  const [visualizer, setVisualizer] = useState<Visualizer | undefined>(\n    undefined\n  )\n\n  useEffect(() => {\n    if (domElement.current && !newVisualizer) {\n      newVisualizer = new Visualizer(domElement.current)\n      setVisualizer(newVisualizer)\n    }\n  }, [domElement, visualizer])\n\n  const prevParticlesRef = useRef<Particles>()\n  useEffect(() => {\n    prevParticlesRef.current = particles\n  })\n  const prevParticles = prevParticlesRef.current\n\n  const prevBondsRef = useRef<Bonds>()\n  useEffect(() => {\n    prevBondsRef.current = bonds\n  })\n  const prevBonds = prevBondsRef.current\n\n  useEffect(() => {\n    if (!visualizer) {\n      return\n    }\n\n    if (prevParticles) {\n      visualizer.remove(prevParticles.getMesh())\n    }\n    if (particles) {\n      visualizer.add(particles.getMesh())\n    }\n\n    if (prevBonds) {\n      visualizer.remove(prevBonds.getMesh()!)\n    }\n    if (bonds) {\n      visualizer.add(bonds.getMesh()!)\n    }\n  }, [particles, bonds, visualizer])\n\n  useEffect(() => {\n    if (visualizer) {\n      if (cameraTarget) {\n        visualizer.setCameraTarget(cameraTarget)\n      }\n    }\n  }, [cameraTarget, visualizer])\n\n  useEffect(() => {\n    if (visualizer) {\n      if (cameraPosition) {\n        visualizer.setCameraPosition(cameraPosition)\n      }\n    }\n  }, [cameraPosition, visualizer])\n\n  useEffect(() => {\n    // console.log('Will create visualizer')\n    return () => {\n      // console.log('Should dispose visualizer')\n      // visualizer.dispose()\n      newVisualizer = undefined\n    }\n  }, [])\n\n  return (\n    <div style={{ height: '100%', width: '100%' }}>\n      <div style={{ height: '100%', width: '100%' }} ref={domElement} />\n    </div>\n  )\n}\nexport default OMOVIVisualizer\n","import * as THREE from 'three'\nimport ComboControls from '@cognite/three-combo-controls'\nimport { Material } from './materials'\n\n// @ts-ignore\nimport Stats from 'stats.js'\n\nconst inverseModelMatrix = new THREE.Matrix4()\nconst modelViewMatrix = new THREE.Matrix4()\nconst normalMatrix = new THREE.Matrix3()\nconst inverseNormalMatrix = new THREE.Matrix3()\n\nconst adjustCamera = (\n  camera: THREE.PerspectiveCamera,\n  width: number,\n  height: number\n) => {\n  if (camera instanceof THREE.PerspectiveCamera) {\n    camera.aspect = width / height\n  }\n  camera.updateProjectionMatrix()\n}\n\nexport default class Visualizer {\n  private renderer: THREE.WebGLRenderer\n  private canvas: HTMLCanvasElement\n  public scene: THREE.Scene\n  private camera: THREE.PerspectiveCamera\n  private ambientLight: THREE.AmbientLight\n  private directionalLight: THREE.DirectionalLight\n  private controls: ComboControls\n  private clock: THREE.Clock\n  private domElement: HTMLElement\n  private object: THREE.Object3D\n  private stats: Stats\n  private cpuStats: Stats\n  private memoryStats: Stats\n  private materials: { [key: string]: Material }\n\n  // @ts-ignore\n  private latestRequestId?: number\n\n  constructor(domElement: HTMLElement) {\n    this.renderer = new THREE.WebGLRenderer()\n\n    this.canvas = this.renderer.domElement\n    this.domElement = domElement\n    this.domElement.appendChild(this.canvas)\n    this.setupCanvas(this.canvas)\n\n    this.scene = new THREE.Scene()\n\n    this.ambientLight = new THREE.AmbientLight(0xffffff)\n    this.directionalLight = new THREE.DirectionalLight(0xffffff)\n    this.setupLights(this.ambientLight, this.directionalLight, this.scene)\n\n    this.camera = new THREE.PerspectiveCamera(60, 640 / 480, 0.1, 10000)\n    this.setupCamera(this.camera)\n    this.controls = new ComboControls(this.camera, this.canvas)\n\n    this.latestRequestId = undefined\n    this.clock = new THREE.Clock()\n    this.object = new THREE.Object3D()\n    this.scene.add(this.object)\n\n    this.cpuStats = new Stats()\n    this.memoryStats = new Stats()\n    this.cpuStats.showPanel(0) // 0: fps, 1: ms, 2: mb, 3+: custom\n    this.memoryStats.showPanel(2) // 0: fps, 1: ms, 2: mb, 3+: custom\n    document.body.appendChild(this.cpuStats.dom)\n    this.cpuStats.domElement.style.cssText =\n      'position:absolute;top:0px;right:80px;'\n    this.memoryStats.domElement.style.cssText =\n      'position:absolute;top:0px;right:0px;'\n    document.body.appendChild(this.memoryStats.dom)\n\n    this.materials = {}\n    this.animate()\n  }\n\n  add = (object: THREE.Mesh) => {\n    if (object == null) {\n      return\n    }\n\n    if (object.material instanceof Material) {\n      const material = object.material as Material\n      const materialType = material.type\n      if (this.materials[materialType] == null) {\n        this.materials[materialType] = material\n      }\n    }\n\n    this.object.add(object)\n  }\n\n  remove = (object: THREE.Mesh) => {\n    this.object.remove(object)\n  }\n\n  setupLights = (\n    ambientLight: THREE.AmbientLight,\n    directionalLight: THREE.DirectionalLight,\n    scene: THREE.Scene\n  ) => {\n    ambientLight.intensity = 0.3\n    directionalLight.intensity = 0.7\n    scene.add(directionalLight)\n    scene.add(ambientLight)\n  }\n\n  setupCanvas = (canvas: HTMLCanvasElement) => {\n    canvas.style.width = '640px'\n    canvas.style.height = '480px'\n    canvas.style.minWidth = '100%'\n    canvas.style.minHeight = '100%'\n    canvas.style.maxWidth = '100%'\n    canvas.style.maxHeight = '100%'\n  }\n\n  setupCamera = (camera: THREE.PerspectiveCamera) => {\n    camera.position.set(10, 10, 10)\n    camera.lookAt(new THREE.Vector3(0, 0, 0))\n  }\n\n  updateUniforms = (camera: THREE.PerspectiveCamera) => {\n    this.object.matrixWorld.copy(this.object.matrixWorld).invert()\n    modelViewMatrix\n      .copy(camera.matrixWorldInverse)\n      .multiply(this.object.matrixWorld)\n    normalMatrix.getNormalMatrix(modelViewMatrix)\n    inverseNormalMatrix.copy(normalMatrix).invert()\n\n    Object.values(this.materials).forEach((material) => {\n      if (material.uniforms.inverseModelMatrix != null) {\n        material.uniforms.inverseModelMatrix.value.copy(inverseModelMatrix)\n      }\n      if (material.uniforms.inverseNormalMatrix != null) {\n        material.uniforms.inverseNormalMatrix.value.copy(inverseNormalMatrix)\n      }\n    })\n  }\n\n  dispose = () => {\n    this.domElement.removeChild(this.canvas)\n    this.renderer.dispose()\n  }\n\n  getCameraPosition = () => {\n    return this.controls.getState().position\n  }\n\n  getCameraTarget = () => {\n    return this.controls.getState().target\n  }\n\n  setCameraPosition = (position: THREE.Vector3) => {\n    this.controls.setState(position, this.getCameraTarget())\n  }\n\n  setCameraTarget = (target: THREE.Vector3) => {\n    this.controls.setState(this.getCameraPosition(), target)\n  }\n\n  animate = () => {\n    this.memoryStats.update()\n    this.cpuStats.begin()\n    this.resizeIfNeeded()\n    this.controls.update(this.clock.getDelta())\n\n    this.updateUniforms(this.camera)\n    this.renderer.render(this.scene, this.camera)\n    this.cpuStats.end()\n\n    this.latestRequestId = requestAnimationFrame(this.animate.bind(this))\n    // console.log(this.camera.position.clone())\n  }\n\n  resizeIfNeeded = () => {\n    // The maxTextureSize is chosen from testing on low-powered hardware,\n    // and could be increased in the future.\n    // TODO Increase maxTextureSize if SSAO performance is improved\n    const maxTextureSize = 1.4e6\n\n    const rendererSize = this.renderer.getSize(new THREE.Vector2())\n    const rendererPixelWidth = rendererSize.width\n    const rendererPixelHeight = rendererSize.height\n\n    // client width and height are in virtual pixels and not yet scaled by dpr\n    // TODO VERSION 5.0.0 remove the test for dom element size once we have removed the getCanvas function\n    const clientWidth =\n      this.domElement.clientWidth !== 0\n        ? this.domElement.clientWidth\n        : this.canvas.clientWidth\n    const clientHeight =\n      this.domElement.clientHeight !== 0\n        ? this.domElement.clientHeight\n        : this.canvas.clientHeight\n    const clientPixelWidth = window.devicePixelRatio * clientWidth\n    const clientPixelHeight = window.devicePixelRatio * clientHeight\n    const clientTextureSize = clientPixelWidth * clientPixelHeight\n\n    const scale =\n      clientTextureSize > maxTextureSize\n        ? Math.sqrt(maxTextureSize / clientTextureSize)\n        : 1\n\n    const width = clientPixelWidth * scale\n    const height = clientPixelHeight * scale\n\n    const maxError = 0.1 // pixels\n    const isOptimalSize =\n      Math.abs(rendererPixelWidth - width) < maxError &&\n      Math.abs(rendererPixelHeight - height) < maxError\n\n    if (isOptimalSize) {\n      return false\n    }\n\n    this.renderer.setSize(width, height)\n\n    adjustCamera(this.camera, width, height)\n\n    return true\n  }\n}\n","import * as THREE from 'three'\nimport fragmentShader from './shaders/fragment'\nimport vertexShader from './shaders/vertex'\nimport createMaterial from 'core/materials'\n\nclass Particles {\n  types: string[]\n  positions: Float32Array\n  indices: Float32Array\n  radii: Float32Array\n  colors: THREE.Color[]\n  count: number\n  capacity: number\n  mesh?: THREE.InstancedMesh\n  geometry?: THREE.InstancedBufferGeometry\n\n  constructor(capacity: number) {\n    this.types = []\n    this.positions = new Float32Array(3 * capacity)\n    this.indices = new Float32Array(capacity)\n    this.radii = new Float32Array(capacity)\n    this.colors = []\n    this.count = 0\n    this.capacity = capacity\n    this.mesh = undefined\n    this.geometry = undefined\n  }\n\n  add({\n    x,\n    y,\n    z,\n    id,\n    radius,\n    type = 'H',\n    r = 255.0,\n    g = 0.0,\n    b = 0.0\n  }: {\n    x: number\n    y: number\n    z: number\n    id: number\n    radius: number\n    type: string\n    r: number\n    g: number\n    b: number\n  }) {\n    if (this.count === this.capacity) {\n      console.log(\"Warning, can't add particle because arrays are full\")\n      return\n    }\n\n    const index = this.count\n\n    this.positions[3 * index + 0] = x\n    this.positions[3 * index + 1] = y\n    this.positions[3 * index + 2] = z\n    this.colors.push(new THREE.Color(r / 255, g / 255, b / 255))\n    this.radii[index] = radius * 0.25\n    this.indices[index] = id\n    this.types.push(type)\n\n    this.count += 1\n  }\n\n  getRadius = (index: number) => {\n    return this.radii[index]\n  }\n\n  getPosition = (index: number) => {\n    return new THREE.Vector3(\n      this.positions[3 * index + 0],\n      this.positions[3 * index + 1],\n      this.positions[3 * index + 2]\n    )\n  }\n\n  getType = (index: number) => {\n    return this.types[index]\n  }\n\n  getGeometry = () => {\n    const baseGeometry = new THREE.PlaneBufferGeometry(1, 1, 1, 1)\n    const geometry = new THREE.InstancedBufferGeometry()\n\n    geometry.instanceCount = this.count\n    geometry.setIndex(baseGeometry.getIndex())\n    geometry.setAttribute('position', baseGeometry.getAttribute('position'))\n    geometry.setAttribute('normal', baseGeometry.getAttribute('normal'))\n    geometry.setAttribute(\n      'particlePosition',\n      new THREE.InstancedBufferAttribute(this.positions, 3, false, 1)\n    )\n    geometry.setAttribute(\n      'particleRadius',\n      new THREE.InstancedBufferAttribute(this.radii, 1, false, 1)\n    )\n\n    return geometry\n  }\n\n  getMesh = () => {\n    if (this.mesh != null) {\n      return this.mesh\n    }\n    const material = createMaterial('particle', vertexShader, fragmentShader)\n    this.geometry = this.getGeometry()\n    this.mesh = new THREE.InstancedMesh(this.geometry, material, this.count)\n\n    const matrix = new THREE.Matrix4()\n    for (let i = 0; i < this.count; i++) {\n      this.mesh.setMatrixAt(i, matrix)\n      if (i < this.colors.length) {\n        this.mesh.setColorAt(i, this.colors[i])\n      } else {\n        this.mesh.setColorAt(i, new THREE.Color('red'))\n      }\n    }\n    this.mesh.frustumCulled = false\n\n    return this.mesh\n  }\n\n  markNeedsUpdate = () => {\n    if (this.mesh) {\n      Object.values(this.mesh.geometry.attributes).forEach((attribute) => {\n        attribute.needsUpdate = true\n      })\n    }\n\n    if (this.geometry) {\n      this.geometry.instanceCount = this.count\n    }\n  }\n}\n\nexport default Particles\n","export default /* glsl */ `\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\nuniform mat4 projectionMatrix;\nvarying vec3 vSurfacePoint;\nvarying vec3 vCenter;\nvarying float vRadius;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tvec3 rayTarget = vSurfacePoint;\n\tvec3 rayDirection = normalize(rayTarget); // rayOrigin is (0,0,0) in camera space\n\n\tvec3 diff = rayTarget - vCenter.xyz;\n    vec3 E = diff;\n    vec3 D = rayDirection;\n\n    float a = dot(D, D);\n    float b = dot(E, D);\n    float c = dot(E, E) - vRadius*vRadius;\n\n    // discriminant of sphere equation (factor 2 removed from b above)\n    float d = b*b - a*c;\n    if(d < 0.0)\n        discard;\n\t\n    float sqrtd = sqrt(d);\n    float dist1 = (-b - sqrtd)/a;\n    float dist2 = (-b + sqrtd)/a;\n\n    // Make sure dist1 is the smaller one\n    if (dist2 < dist1) {\n        float tmp = dist1;\n        dist1 = dist2;\n        dist2 = tmp;\n    }\n\n    float dist = dist1;\n    float intersectionPointZ = E.z + dist*D.z;\n\tvec3 p = rayTarget + dist*rayDirection;\n\n\t// Find normal vector in local space\n    normal = normalize(vec3(p - vCenter.xyz));\n    // Transform into camera space\n    if (dot(normal, rayDirection) >  0.) {\n        normal = -normal;\n    }\n\n#ifdef FRAG_DEPTH\n\tfloat projectedIntersection_z = projectionMatrix[0][2]*p.x + projectionMatrix[1][2]*p.y + projectionMatrix[2][2]*p.z + projectionMatrix[3][2];\n\tfloat projectedIntersection_w = projectionMatrix[0][3]*p.x + projectionMatrix[1][3]*p.y + projectionMatrix[2][3]*p.z + projectionMatrix[3][3];\n\tgl_FragDepthEXT = ((gl_DepthRange.diff * (projectedIntersection_z / projectedIntersection_w)) + gl_DepthRange.near + gl_DepthRange.far) * 0.5;\n#endif\n\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n`\n","import * as THREE from 'three'\nimport fragmentShader from './shaders/fragment'\nimport vertexShader from './shaders/vertex'\nimport createMaterial from 'core/materials'\n\nclass Bonds {\n  positions1: Float32Array\n  positions2: Float32Array\n  indices: Float32Array\n  radii: Float32Array\n  colors: THREE.Color[]\n  count: number\n  capacity: number\n  mesh?: THREE.InstancedMesh\n\n  constructor(capacity: number) {\n    this.positions1 = new Float32Array(3 * capacity)\n    this.positions2 = new Float32Array(3 * capacity)\n    this.indices = new Float32Array(capacity)\n    this.radii = new Float32Array(capacity)\n    this.colors = []\n    this.count = 0\n    this.capacity = capacity\n    this.mesh = undefined\n  }\n\n  add(\n    x1: number,\n    y1: number,\n    z1: number,\n    x2: number,\n    y2: number,\n    z2: number,\n    radius: number,\n    r: number = 255.0,\n    g: number = 255.0,\n    b: number = 255.0\n  ) {\n    if (this.count === this.capacity) {\n      console.log(\"Warning, can't add particle because arrays are full\")\n      return\n    }\n\n    const index = this.count\n\n    this.positions1[3 * index + 0] = x1\n    this.positions1[3 * index + 1] = y1\n    this.positions1[3 * index + 2] = z1\n    this.positions2[3 * index + 0] = x2\n    this.positions2[3 * index + 1] = y2\n    this.positions2[3 * index + 2] = z2\n\n    this.colors.push(new THREE.Color(r / 255, g / 255, b / 255))\n\n    this.radii[index] = radius * 0.25\n    this.indices[index] = index\n\n    this.count += 1\n  }\n\n  getRadius = (index: number) => {\n    return this.radii[index]\n  }\n\n  getPosition1 = (index: number) => {\n    return new THREE.Vector3(\n      this.positions1[3 * index + 0],\n      this.positions1[3 * index + 1],\n      this.positions1[3 * index + 2]\n    )\n  }\n\n  getGeometry = () => {\n    const positions = []\n    positions.push(-1, 1, -1)\n    positions.push(-1, -1, -1)\n    positions.push(1, 1, -1)\n    positions.push(1, -1, -1)\n    positions.push(1, 1, 1)\n    positions.push(1, -1, 1)\n\n    const positionBufferAttribute = new THREE.BufferAttribute(\n      new Float32Array(positions),\n      3\n    )\n    const indexBufferAttribute = new THREE.BufferAttribute(\n      new Uint16Array([1, 2, 0, 1, 3, 2, 3, 4, 2, 3, 5, 4]),\n      1\n    )\n\n    const geometry = new THREE.InstancedBufferGeometry()\n\n    geometry.instanceCount = this.count\n    geometry.setIndex(indexBufferAttribute)\n    geometry.setAttribute('position', positionBufferAttribute)\n    geometry.setAttribute('normal', positionBufferAttribute)\n\n    geometry.setAttribute(\n      'position1',\n      new THREE.InstancedBufferAttribute(this.positions1, 3, false, 1)\n    )\n\n    geometry.setAttribute(\n      'position2',\n      new THREE.InstancedBufferAttribute(this.positions2, 3, false, 1)\n    )\n\n    geometry.setAttribute(\n      'bondRadius',\n      new THREE.InstancedBufferAttribute(this.radii, 1, false, 1)\n    )\n\n    return geometry\n  }\n\n  getMesh = () => {\n    if (this.mesh != null) {\n      return this.mesh\n    }\n\n    if (this.count === 0) {\n      return null\n    }\n\n    const geometry = this.getGeometry()\n    const material = createMaterial('bonds', vertexShader, fragmentShader)\n    this.mesh = new THREE.InstancedMesh(geometry, material, this.count)\n\n    const matrix = new THREE.Matrix4()\n    for (let i = 0; i < this.count; i++) {\n      this.mesh.setMatrixAt(i, matrix)\n      this.mesh.setColorAt(i, this.colors[i])\n    }\n    this.mesh.frustumCulled = false\n\n    return this.mesh\n  }\n}\n\nexport default Bonds\n","export default /* glsl */ `\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\nuniform mat4 projectionMatrix;\nvarying vec4 v_position1;\nvarying vec4 v_position2;\nvarying vec4 U;\nvarying vec4 V;\nvarying vec4 axis;\nvarying float height;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tmat3 basis = mat3(U.xyz, V.xyz, axis.xyz);\n    vec3 surfacePoint = vec3(U.w, V.w, axis.w);\n    vec3 rayTarget = surfacePoint;\n\tvec3 rayDirection = normalize(rayTarget); // rayOrigin is (0,0,0) in camera space\n\n\tvec3 diff = rayTarget - v_position2.xyz;\n    vec3 E = diff * basis;\n    float L = height;\n    vec3 D = rayDirection * basis;\n\n    float R1 = v_position1.w;\n    float R2 = v_position2.w;\n    float dR = R2 - R1;\n\n    float a = dot(D.xy, D.xy);\n    float b = dot(E.xy, D.xy);\n    float c = dot(E.xy, E.xy)-R1*R1;\n    float L2Inv = 1.0/(L*L);\n\n\t// Calculate a dicriminant of the above quadratic equation (factor 2 removed from all b-terms above)\n    float d = b*b - a*c;\n\n    // d < 0.0 means the ray hits outside an infinitely long eccentric cone\n    if (d < 0.0) {\n\t\tdiscard;\n    }\n\n\tfloat sqrtd = sqrt(d);\n    float dist1 = (-b - sqrtd)/a;\n    float dist2 = (-b + sqrtd)/a;\n\n    // Make sure dist1 is the smaller one\n    if (dist2 < dist1) {\n      float tmp = dist1;\n      dist1 = dist2;\n      dist2 = tmp;\n    }\n\n\t// Check the smallest root, it is closest camera. Only test if the z-component is outside the truncated eccentric cone\n    float dist = dist1;\n    float intersectionPointZ = E.z + dist*D.z;\n    // Intersection point in camera space\n    vec3 p = rayTarget + dist*rayDirection;\n    bool isInner = false;\n\n    if (intersectionPointZ <= 0.0 ||\n      intersectionPointZ >= L\n      ) {\n      // Either intersection point is behind starting point (happens inside the cone),\n      // or the intersection point is outside the end caps. This is not a valid solution.\n      isInner = true;\n      dist = dist2;\n      intersectionPointZ = E.z + dist*D.z;\n      p = rayTarget + dist*rayDirection;\n\n      if (intersectionPointZ <= 0.0 ||\n        intersectionPointZ >= L\n      ) {\n        // Missed the other point too\n\t\tdiscard;\n      }\n    }\n\n\t// Find normal vector\n    vec3 n = normalize(-axis.xyz);\n    vec3 position1 = v_position1.xyz;\n    vec3 position2 = v_position2.xyz;\n    vec3 A = cross(position1 - p, position2 - p);\n\n    vec3 t = normalize(cross(n, A));\n    vec3 o1 = position1 + R1 * t;\n    vec3 o2 = position2 + R2 * t;\n    vec3 B = o2-o1;\n    normal = normalize(cross(A, B));\n\n#ifdef FRAG_DEPTH\n\tfloat projectedIntersection_z = projectionMatrix[0][2]*p.x + projectionMatrix[1][2]*p.y + projectionMatrix[2][2]*p.z + projectionMatrix[3][2];\n\tfloat projectedIntersection_w = projectionMatrix[0][3]*p.x + projectionMatrix[1][3]*p.y + projectionMatrix[2][3]*p.z + projectionMatrix[3][3];\n\tgl_FragDepthEXT = ((gl_DepthRange.diff * (projectedIntersection_z / projectedIntersection_w)) + gl_DepthRange.near + gl_DepthRange.far) * 0.5;\n#endif\n\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n  \n}\n\n`\n","export interface Color {\n  r: number\n  g: number\n  b: number\n}\n\nexport interface AtomType {\n  fullname: string\n  shortname: string\n  radius: number\n  color: Color\n}\n\nconst colors: Color[] = [\n  { r: 255, g: 102, b: 102 },\n  { r: 102, g: 102, b: 255 },\n  { r: 255, g: 255, b: 0 },\n  { r: 255, g: 102, b: 255 },\n  { r: 102, g: 255, b: 51 },\n  { r: 204, g: 255, b: 179 },\n  { r: 179, g: 0, b: 255 },\n  { r: 51, g: 255, b: 255 },\n  { r: 247, g: 247, b: 247 }\n]\n\nexport function getColor(particleType: number) {\n  const index = particleType % colors.length\n  return colors[index]\n}\n\nconst AtomTypes: { [key: string]: AtomType } = {\n  H: {\n    shortname: 'H',\n    fullname: 'hydrogen',\n    radius: 1.2,\n    color: { r: 204, g: 204, b: 204 }\n  },\n  He: {\n    shortname: 'He',\n    fullname: 'helium',\n    radius: 1.4,\n    color: { r: 217, g: 255, b: 255 }\n  },\n  Li: {\n    shortname: 'Li',\n    fullname: 'lithium',\n    radius: 1.82,\n    color: { r: 204, g: 128, b: 255 }\n  },\n  Be: {\n    shortname: 'Be',\n    fullname: 'beryllium',\n    radius: 1.53,\n    color: { r: 194, g: 255, b: 0 }\n  },\n  B: {\n    shortname: 'B',\n    fullname: 'boron',\n    radius: 1.92,\n    color: { r: 255, g: 181, b: 181 }\n  },\n  C: {\n    shortname: 'C',\n    fullname: 'carbon',\n    radius: 1.7,\n    color: { r: 80, g: 80, b: 80 }\n  },\n  N: {\n    shortname: 'N',\n    fullname: 'nitrogen',\n    radius: 1.55,\n    color: { r: 48, g: 80, b: 248 }\n  },\n  O: {\n    shortname: 'O',\n    fullname: 'oxygen',\n    radius: 1.52,\n    color: { r: 170, g: 0, b: 0 }\n  },\n  F: {\n    shortname: 'F',\n    fullname: 'fluorine',\n    radius: 1.35,\n    color: { r: 144, g: 224, b: 80 }\n  },\n  Ne: {\n    shortname: 'Ne',\n    fullname: 'neon',\n    radius: 1.54,\n    color: { r: 48, g: 80, b: 248 }\n  },\n  Na: {\n    shortname: 'Na',\n    fullname: 'sodium',\n    radius: 2.27,\n    color: { r: 171, g: 92, b: 242 }\n  },\n  Mg: {\n    shortname: 'Mg',\n    fullname: 'magnesium',\n    radius: 1.73,\n    color: { r: 138, g: 255, b: 0 }\n  },\n  Al: {\n    shortname: 'Al',\n    fullname: 'aluminium',\n    radius: 1.84,\n    color: { r: 191, g: 166, b: 166 }\n  },\n  Si: {\n    shortname: 'Si',\n    fullname: 'silicon',\n    radius: 2.27,\n    color: { r: 240, g: 200, b: 160 }\n  },\n  P: {\n    shortname: 'P',\n    fullname: 'phosphorus',\n    radius: 1.8,\n    color: { r: 255, g: 128, b: 0 }\n  },\n  S: {\n    shortname: 'S',\n    fullname: 'sulfur',\n    radius: 1.8,\n    color: { r: 255, g: 255, b: 48 }\n  },\n  Cl: {\n    shortname: 'Cl',\n    fullname: 'chlorine',\n    radius: 1.75,\n    color: { r: 31, g: 240, b: 31 }\n  },\n  Ar: {\n    shortname: 'Ar',\n    fullname: 'argon',\n    radius: 1.88,\n    color: { r: 128, g: 209, b: 227 }\n  },\n  K: {\n    shortname: 'K',\n    fullname: 'potassium',\n    radius: 2.75,\n    color: { r: 143, g: 64, b: 212 }\n  },\n  Ca: {\n    shortname: 'Ca',\n    fullname: 'calcium',\n    radius: 2.31,\n    color: { r: 61, g: 255, b: 0 }\n  },\n  Sc: {\n    shortname: 'Sc',\n    fullname: 'scandium',\n    radius: 2.11,\n    color: { r: 230, g: 230, b: 230 }\n  },\n  Ti: {\n    shortname: 'Ti',\n    fullname: 'titanium',\n    radius: 2.0,\n    color: { r: 191, g: 194, b: 199 }\n  },\n  V: {\n    shortname: 'V',\n    fullname: 'vanadium',\n    radius: 2.0,\n    color: { r: 166, g: 166, b: 171 }\n  },\n  Cr: {\n    shortname: 'Cr',\n    fullname: 'chromium',\n    radius: 2.0,\n    color: { r: 138, g: 153, b: 199 }\n  },\n  Mn: {\n    shortname: 'Mn',\n    fullname: 'manganese',\n    radius: 2.0,\n    color: { r: 156, g: 122, b: 199 }\n  },\n  Fe: {\n    shortname: 'Fe',\n    fullname: 'iron',\n    radius: 2.0,\n    color: { r: 224, g: 102, b: 51 }\n  },\n  Co: {\n    shortname: 'Co',\n    fullname: 'cobalt',\n    radius: 2.0,\n    color: { r: 240, g: 144, b: 160 }\n  },\n  Ni: {\n    shortname: 'Ni',\n    fullname: 'nickel',\n    radius: 1.63,\n    color: { r: 80, g: 208, b: 80 }\n  },\n  Cu: {\n    shortname: 'Cu',\n    fullname: 'copper',\n    radius: 1.4,\n    color: { r: 200, g: 128, b: 51 }\n  },\n  Zn: {\n    shortname: 'Zn',\n    fullname: 'zinc',\n    radius: 1.39,\n    color: { r: 125, g: 128, b: 176 }\n  },\n  Ga: {\n    shortname: 'Ga',\n    fullname: 'gallium',\n    radius: 1.87,\n    color: { r: 194, g: 143, b: 143 }\n  },\n  Ge: {\n    shortname: 'Ge',\n    fullname: 'germanium',\n    radius: 2.11,\n    color: { r: 102, g: 143, b: 143 }\n  },\n  As: {\n    shortname: 'As',\n    fullname: 'arsenic',\n    radius: 1.85,\n    color: { r: 189, g: 128, b: 227 }\n  },\n  Se: {\n    shortname: 'Se',\n    fullname: 'selenium',\n    radius: 1.9,\n    color: { r: 255, g: 161, b: 0 }\n  },\n  Br: {\n    shortname: 'Br',\n    fullname: 'bromine',\n    radius: 1.85,\n    color: { r: 166, g: 41, b: 41 }\n  },\n  Kr: {\n    shortname: 'Kr',\n    fullname: 'krypton',\n    radius: 2.02,\n    color: { r: 92, g: 184, b: 209 }\n  },\n  Rb: {\n    shortname: 'Rb',\n    fullname: 'rubidium',\n    radius: 3.03,\n    color: { r: 112, g: 46, b: 176 }\n  },\n  Sr: {\n    shortname: 'Sr',\n    fullname: 'strontium',\n    radius: 2.49,\n    color: { r: 0, g: 255, b: 0 }\n  },\n  Y: {\n    shortname: 'Y',\n    fullname: 'yttrium',\n    radius: 2.0,\n    color: { r: 148, g: 255, b: 255 }\n  },\n  Zr: {\n    shortname: 'Zr',\n    fullname: 'zirconium',\n    radius: 2.0,\n    color: { r: 148, g: 224, b: 224 }\n  },\n  Nb: {\n    shortname: 'Nb',\n    fullname: 'niobium',\n    radius: 2.0,\n    color: { r: 115, g: 194, b: 201 }\n  },\n  Mo: {\n    shortname: 'Mo',\n    fullname: 'molybdenum',\n    radius: 2.0,\n    color: { r: 84, g: 181, b: 181 }\n  },\n  Tc: {\n    shortname: 'Tc',\n    fullname: 'technetium',\n    radius: 2.0,\n    color: { r: 59, g: 158, b: 158 }\n  },\n  Ru: {\n    shortname: 'Ru',\n    fullname: 'ruthenium',\n    radius: 2.0,\n    color: { r: 36, g: 143, b: 143 }\n  },\n  Rh: {\n    shortname: 'Rh',\n    fullname: 'rhodium',\n    radius: 2.0,\n    color: { r: 10, g: 125, b: 140 }\n  },\n  Pd: {\n    shortname: 'Pd',\n    fullname: 'palladium',\n    radius: 1.63,\n    color: { r: 0, g: 105, b: 133 }\n  },\n  Ag: {\n    shortname: 'Ag',\n    fullname: 'silver',\n    radius: 1.72,\n    color: { r: 192, g: 192, b: 192 }\n  },\n  Cd: {\n    shortname: 'Cd',\n    fullname: 'cadmium',\n    radius: 1.58,\n    color: { r: 255, g: 217, b: 143 }\n  },\n  In: {\n    shortname: 'In',\n    fullname: 'indium',\n    radius: 1.93,\n    color: { r: 166, g: 117, b: 115 }\n  },\n  Sn: {\n    shortname: 'Sn',\n    fullname: 'tin',\n    radius: 2.17,\n    color: { r: 102, g: 128, b: 128 }\n  },\n  Sb: {\n    shortname: 'Sb',\n    fullname: 'antimony',\n    radius: 2.06,\n    color: { r: 158, g: 99, b: 181 }\n  },\n  Te: {\n    shortname: 'Te',\n    fullname: 'tellurium',\n    radius: 2.06,\n    color: { r: 212, g: 122, b: 0 }\n  },\n  I: {\n    shortname: 'I',\n    fullname: 'iodine',\n    radius: 1.98,\n    color: { r: 148, g: 0, b: 148 }\n  },\n  Xe: {\n    shortname: 'Xe',\n    fullname: 'xenon',\n    radius: 2.16,\n    color: { r: 66, g: 158, b: 176 }\n  },\n  Cs: {\n    shortname: 'Cs',\n    fullname: 'caesium',\n    radius: 3.43,\n    color: { r: 87, g: 23, b: 143 }\n  },\n  Ba: {\n    shortname: 'Ba',\n    fullname: 'barium',\n    radius: 2.68,\n    color: { r: 0, g: 201, b: 0 }\n  },\n  La: {\n    shortname: 'La',\n    fullname: 'lanthanum',\n    radius: 2.0,\n    color: { r: 112, g: 212, b: 255 }\n  },\n  Ce: {\n    shortname: 'Ce',\n    fullname: 'cerium',\n    radius: 2.0,\n    color: { r: 255, g: 255, b: 199 }\n  },\n  Pr: {\n    shortname: 'Pr',\n    fullname: 'praseodymium',\n    radius: 2.0,\n    color: { r: 217, g: 255, b: 199 }\n  },\n  Nd: {\n    shortname: 'Nd',\n    fullname: 'neodymium',\n    radius: 2.0,\n    color: { r: 199, g: 255, b: 199 }\n  },\n  Pm: {\n    shortname: 'Pm',\n    fullname: 'promethium',\n    radius: 2.0,\n    color: { r: 163, g: 255, b: 199 }\n  },\n  Sm: {\n    shortname: 'Sm',\n    fullname: 'samarium',\n    radius: 2.0,\n    color: { r: 143, g: 255, b: 199 }\n  },\n  Eu: {\n    shortname: 'Eu',\n    fullname: 'europium',\n    radius: 2.0,\n    color: { r: 97, g: 255, b: 199 }\n  },\n  Gd: {\n    shortname: 'Gd',\n    fullname: 'gadolinium',\n    radius: 2.0,\n    color: { r: 69, g: 255, b: 199 }\n  },\n  Tb: {\n    shortname: 'Tb',\n    fullname: 'terbium',\n    radius: 2.0,\n    color: { r: 48, g: 255, b: 199 }\n  },\n  Dy: {\n    shortname: 'Dy',\n    fullname: 'dysprosium',\n    radius: 2.0,\n    color: { r: 31, g: 255, b: 199 }\n  },\n  Ho: {\n    shortname: 'Ho',\n    fullname: 'holmium',\n    radius: 2.0,\n    color: { r: 0, g: 255, b: 156 }\n  },\n  Er: {\n    shortname: 'Er',\n    fullname: 'erbium',\n    radius: 2.0,\n    color: { r: 0, g: 230, b: 117 }\n  },\n  Tm: {\n    shortname: 'Tm',\n    fullname: 'thulium',\n    radius: 2.0,\n    color: { r: 0, g: 212, b: 82 }\n  },\n  Yb: {\n    shortname: 'Yb',\n    fullname: 'ytterbium',\n    radius: 2.0,\n    color: { r: 0, g: 191, b: 56 }\n  },\n  Lu: {\n    shortname: 'Lu',\n    fullname: 'lutetium',\n    radius: 2.0,\n    color: { r: 0, g: 171, b: 36 }\n  },\n  Hf: {\n    shortname: 'Hf',\n    fullname: 'hafnium',\n    radius: 2.0,\n    color: { r: 77, g: 194, b: 255 }\n  },\n  Ta: {\n    shortname: 'Ta',\n    fullname: 'tantalum',\n    radius: 2.0,\n    color: { r: 77, g: 166, b: 255 }\n  },\n  W: {\n    shortname: 'W',\n    fullname: 'tungsten',\n    radius: 2.0,\n    color: { r: 33, g: 148, b: 214 }\n  }\n}\n\nexport default AtomTypes\n","import SimulationDataFrame from './simulationdataframe'\nimport Bonds from 'core/geometries/bonds/bonds'\n\nexport default class SimulationData {\n  frames: SimulationDataFrame[]\n  generateBondsFunction?: (frame: SimulationDataFrame) => Bonds\n  constructor() {\n    this.frames = []\n  }\n\n  getFrame = (index: number) => {\n    const frame = this.frames[index]\n    if (this.generateBondsFunction && frame.bonds == null) {\n      const bonds = this.generateBondsFunction(frame)\n      if (bonds.count > 0) {\n        frame.bonds = bonds\n      }\n    }\n\n    return frame\n  }\n\n  getNumFrames = () => {\n    return this.frames.length\n  }\n}\n","import * as THREE from 'three'\n\nexport default class SimulationCell {\n  vector1: THREE.Vector3\n  vector2: THREE.Vector3\n  vector3: THREE.Vector3\n  origin: THREE.Vector3\n  constructor(\n    vector1: THREE.Vector3,\n    vector2: THREE.Vector3,\n    vector3: THREE.Vector3,\n    origin: THREE.Vector3\n  ) {\n    this.vector1 = vector1\n    this.vector2 = vector2\n    this.vector3 = vector3\n    this.origin = origin\n  }\n\n  getCenter = () => {\n    const center = this.origin\n      .clone()\n      .add(this.vector1.clone().multiplyScalar(0.5))\n      .add(this.vector2.clone().multiplyScalar(0.5))\n      .add(this.vector3.clone().multiplyScalar(0.5))\n    return center\n  }\n\n  getOrigin = () => {\n    return this.origin.clone()\n  }\n\n  getBoundingBox = () => {\n    const box = new THREE.Box3()\n    box.expandByPoint(this.origin.clone().add(this.vector1))\n    box.expandByPoint(this.origin.clone().add(this.vector2))\n    box.expandByPoint(this.origin.clone().add(this.vector3))\n    box.expandByPoint(this.origin)\n    return box\n  }\n}\n","import * as THREE from 'three'\nimport Particles from 'core/geometries/particles/particles'\nimport Bonds from 'core/geometries/bonds/bonds'\nimport SimulationCell from './simulationcell'\n\nexport default class SimulationDataFrame {\n  simulationCell: SimulationCell\n  particleTypes: string[]\n  particles: Particles\n  bonds?: Bonds\n\n  constructor(particles: Particles, simulationCell?: SimulationCell) {\n    this.particles = particles\n\n    const particleTypeMap: { [key: string]: boolean } = {}\n    particles.types.forEach((particleType: string) => {\n      particleTypeMap[particleType] = true\n    })\n\n    // @ts-ignore\n    this.particleTypes = Object.keys(particleTypeMap)\n\n    if (simulationCell) {\n      this.simulationCell = simulationCell\n    } else {\n      this.simulationCell = this.generateSimulationCell()\n    }\n  }\n\n  generateSimulationCell = () => {\n    let box = new THREE.Box3()\n    for (let i = 0; i < this.particles.count; i++) {\n      box = box.expandByPoint(this.particles.getPosition(i))\n    }\n\n    const size = box.getSize(new THREE.Vector3())\n    const origin = box\n      .getCenter(new THREE.Vector3())\n      .sub(size.clone().multiplyScalar(0.5))\n    const simulationCell = new SimulationCell(\n      new THREE.Vector3(size.x, 0, 0),\n      new THREE.Vector3(0, size.y, 0),\n      new THREE.Vector3(0, 0, size.x),\n      origin\n    )\n    return simulationCell\n  }\n}\n","import Particles from 'core/geometries/particles/particles'\nimport AtomTypes from 'core/atomtypes'\nimport SimulationData from 'core/simulationdata/simulationdata'\nimport SimulationDataFrame from 'core/simulationdata/simulationdataframe'\n\nfunction addParticlesToFrame(lines: string[], i: number, particles: Particles) {\n  for (let j = 0; j < particles.capacity; j++) {\n    const lineData = lines[i + j].split(/\\s+/).filter(Boolean)\n    const element = lineData[0]\n\n    const atomType = AtomTypes[element]\n    let color = { r: 255, g: 102, b: 102 }\n    let radius = 1.0\n    if (atomType) {\n      radius = atomType.radius\n      color = atomType.color\n    }\n    const x = parseFloat(lineData[1])\n    const y = parseFloat(lineData[2])\n    const z = parseFloat(lineData[3])\n    const id = j\n\n    particles.add({\n      x,\n      y,\n      z,\n      id,\n      radius,\n      r: color.r,\n      g: color.g,\n      b: color.b,\n      type: atomType.shortname\n    })\n  }\n}\n\nconst parseXyz = (data: string): SimulationData => {\n  let particles: Particles | undefined\n  const frames: SimulationDataFrame[] = []\n\n  const lines = data.split('\\n')\n  const numLines = lines.length\n  let i = 0\n  let skipNextLine = false\n  let readNumParticles = true\n\n  while (i < numLines) {\n    if (lines[i] === '') {\n      i++\n      continue\n    }\n\n    if (skipNextLine) {\n      skipNextLine = false\n    } else if (readNumParticles) {\n      const numParticles = parseInt(lines[i], 10)\n\n      if (isNaN(numParticles)) {\n        console.log('Warning, got NaN as numParticles')\n        break\n      }\n\n      particles = new Particles(numParticles)\n      readNumParticles = false\n      skipNextLine = true\n    } else {\n      if (particles) {\n        addParticlesToFrame(lines, i, particles)\n        const frame = new SimulationDataFrame(particles)\n        frames.push(frame)\n        i += particles.count - 1\n        readNumParticles = true\n      }\n    }\n\n    i++\n  }\n\n  const simulationData = new SimulationData()\n  simulationData.frames = frames\n\n  return simulationData\n}\n\nexport default parseXyz\n","import Particles from 'core/geometries/particles/particles'\nimport SimulationData from 'core/simulationdata/simulationdata'\nimport SimulationDataFrame from 'core/simulationdata/simulationdataframe'\nimport * as THREE from 'three'\nimport { getColor } from 'core/atomtypes'\n// @ts-ignore\nimport { Parser } from 'binary-parser'\nimport SimulationCell from 'core/simulationdata/simulationcell'\n\nconst parseHeader = (buffer: Buffer, offset: number = 0) => {\n  const triclinicParser = new Parser()\n    .endianess('little')\n    .doublele('xy')\n    .doublele('xz')\n    .doublele('yz')\n\n  const noParser = new Parser()\n\n  // const ipHeader = getHeader()\n  const ipHeader = new Parser()\n    .endianess('little')\n    .seek(offset)\n    .int64('numTimesteps')\n    .int64('numAtoms')\n    .int32('isTriclinic')\n    .int32('boundary0')\n    .int32('boundary1')\n    .int32('boundary2')\n    .int32('boundary3')\n    .int32('boundary4')\n    .int32('boundary5')\n    .doublele('xlo')\n    .doublele('xhi')\n    .doublele('ylo')\n    .doublele('yhi')\n    .doublele('zlo')\n    .doublele('zhi')\n    .choice('triclinic', {\n      tag: 'isTriclinic',\n      choices: {\n        1: triclinicParser,\n        0: noParser\n      }\n    })\n    .int32('sizeOne')\n    .int32('numChunks')\n    // @ts-ignore\n    .saveOffset('headerOffset')\n\n  return ipHeader.parse(buffer)\n}\n\nconst parseFrame = (buffer: Buffer, offset: number = 0) => {\n  const header = parseHeader(buffer, offset)\n\n  // @ts-ignore\n  offset = header.headerOffset // This new offset includes the header\n  const particles = new Particles(Number(header.numAtoms))\n\n  // @ts-ignore\n  for (let chunkIndex = 0; chunkIndex < header.numChunks; chunkIndex++) {\n    const chunkParser = new Parser()\n      .endianess('little')\n      // @ts-ignore\n      .seek(offset)\n      .int32le('bufferSize')\n      .array('buffer', { type: 'doublele', length: 'bufferSize' })\n      // @ts-ignore\n      .saveOffset('chunkOffset')\n    const chunk = chunkParser.parse(buffer)\n    offset = chunk.chunkOffset // New offset including the chunk\n    // Add particles from chunk\n    for (\n      let particleIndex = 0;\n      particleIndex < header.numAtoms;\n      particleIndex++\n    ) {\n      const id = chunk.buffer[0 + particleIndex * header.sizeOne]\n      const type = chunk.buffer[1 + particleIndex * header.sizeOne]\n      const x = chunk.buffer[2 + particleIndex * header.sizeOne]\n      const y = chunk.buffer[3 + particleIndex * header.sizeOne]\n      const z = chunk.buffer[4 + particleIndex * header.sizeOne]\n      const color = getColor(type)\n      const typeStr = type.toString()\n      particles.add({\n        x,\n        y,\n        z,\n        radius: 0.05,\n        id,\n        type: typeStr,\n        r: color.r,\n        g: color.g,\n        b: color.b\n      })\n    }\n  }\n\n  let xy, xz, yz\n  if (header.isTriclinic) {\n    xy = header.triclinic.xy\n    xz = header.triclinic.xz\n    yz = header.triclinic.yz\n  }\n  // Create frame from all particles and update simulation cell\n  const simulationDataFrame = new SimulationDataFrame(particles)\n  simulationDataFrame.simulationCell = new SimulationCell(\n    new THREE.Vector3(header.xhi - header.xlo, 0, 0),\n    new THREE.Vector3(xy, header.yhi - header.ylo, 0),\n    new THREE.Vector3(xz, yz, header.zhi - header.zlo),\n    new THREE.Vector3(header.xlo, header.ylo, header.zlo)\n  )\n  return {\n    simulationDataFrame: new SimulationDataFrame(particles),\n    offset\n  }\n}\n\nconst parse = (arrayBuffer: ArrayBuffer) => {\n  const mainBuffer = Buffer.from(arrayBuffer)\n\n  const simulationData = new SimulationData()\n  let offset = 0\n  while (offset < mainBuffer.length) {\n    const response = parseFrame(mainBuffer, offset)\n    offset = response.offset\n    simulationData.frames.push(response.simulationDataFrame)\n  }\n  return simulationData\n}\n\nexport default parse\n","import Particles from 'core/geometries/particles/particles'\nimport { getColor } from 'core/atomtypes'\nimport SimulationData from 'core/simulationdata/simulationdata'\nimport SimulationCell from 'core/simulationdata/simulationcell'\nimport SimulationDataFrame from 'core/simulationdata/simulationdataframe'\n\nimport * as THREE from 'three'\n\nclass ParseError extends Error {}\n\nconst ensureLineContains = (\n  lineNumber: number,\n  line: string,\n  needle: string\n) => {\n  if (!line.includes(needle)) {\n    throw new ParseError(\n      `Error parsing LAMMPS Data File. Expected ${needle} on line ${lineNumber}. Line: ${line}`\n    )\n  }\n}\n\nconst ensureNotNull = (\n  lines: string[],\n  lineNumber: number,\n  values: { [key: string]: string }\n) => {\n  for (const key in values) {\n    if (values[key] == null) {\n      console.log('Found null value on line ', lines[lineNumber])\n      throw new ParseError(\n        `Error parsing LAMMPS Data File. Expected non-null value for ${key} on line ${lineNumber}. Line: ${lines[lineNumber]}`\n      )\n    }\n  }\n}\n\nconst parseMolecular = (\n  lines: string[],\n  lineNumber: number,\n  particles: Particles\n) => {\n  for (let j = 0; j < particles.capacity; j++) {\n    const [idStr, molIdStr, typeStr, xStr, yStr, zStr] = lines[\n      lineNumber + j\n    ].split(' ')\n    ensureNotNull(lines, lineNumber, {\n      x: xStr,\n      y: yStr,\n      z: zStr,\n      id: idStr,\n      molId: molIdStr,\n      type: typeStr\n    })\n\n    const x = parseFloat(xStr)\n    const y = parseFloat(yStr)\n    const z = parseFloat(zStr)\n    const id = parseInt(idStr)\n    const molId = parseInt(molIdStr)\n    const type = parseInt(typeStr)\n    const radius = 1.0\n    const color = getColor(type)\n    particles.add({\n      x,\n      y,\n      z,\n      id,\n      radius,\n      type: typeStr,\n      r: color.r,\n      g: color.g,\n      b: color.b\n    })\n  }\n}\n\nconst parseAtomic = (\n  lines: string[],\n  lineNumber: number,\n  particles: Particles\n) => {\n  for (let j = 0; j < particles.capacity; j++) {\n    const [idStr, typeStr, xStr, yStr, zStr] = lines[lineNumber + j].split(' ')\n    ensureNotNull(lines, lineNumber, {\n      x: xStr,\n      y: yStr,\n      z: zStr,\n      id: idStr,\n      type: typeStr\n    })\n\n    const x = parseFloat(xStr)\n    const y = parseFloat(yStr)\n    const z = parseFloat(zStr)\n    const id = parseInt(idStr)\n    const type = parseInt(typeStr)\n    const radius = 1.0\n    const color = getColor(type)\n    particles.add({\n      x,\n      y,\n      z,\n      id,\n      radius,\n      type: typeStr,\n      r: color.r,\n      g: color.g,\n      b: color.b\n    })\n  }\n}\n\nconst findNext = (\n  lines: string[],\n  lineNumber: number,\n  needle?: string,\n  callback?: (line: string) => void\n) => {\n  while (lineNumber < lines.length) {\n    const line = lines[lineNumber].trim()\n    if (line.startsWith('#')) {\n      lineNumber++\n      continue\n    }\n    if (line === '') {\n      lineNumber++\n      continue\n    }\n    if (needle) {\n      if (line.includes(needle)) {\n        if (callback) {\n          callback(line)\n        }\n        return lineNumber + 1\n      }\n      throw new ParseError(\n        `Error parsing LAMMPS Data File. Expected ${needle} on line ${lineNumber}. Line: ${lines[lineNumber]}`\n      )\n    }\n    if (callback) {\n      callback(line)\n    }\n    return lineNumber + 1\n  }\n  return lines.length\n}\n\nconst getNextLineNumber = (\n  lines: string[],\n  lineNumber: number,\n  needle?: string\n) => {\n  while (lineNumber < lines.length) {\n    const line = lines[lineNumber].trim()\n    if (line.startsWith('#')) {\n      lineNumber++\n      continue\n    }\n    if (line === '') {\n      lineNumber++\n      continue\n    }\n    if (needle) {\n      if (line.includes(needle)) {\n        return lineNumber\n      }\n    } else {\n      return lineNumber\n    }\n    lineNumber++\n  }\n  return lineNumber\n}\n\nconst parseLAMMPSData = (data: string) => {\n  const lines = data.split('\\n')\n  let lineNumber = 0\n  let numAtoms = 0\n  let xlo = 0\n  let xhi = 0\n  let ylo = 0\n  let yhi = 0\n  let zlo = 0\n  let zhi = 0\n\n  lineNumber = findNext(lines, lineNumber + 1, ' atoms', (line: string) => {\n    numAtoms = parseInt(line.split(' ')[0])\n  })\n\n  lineNumber = findNext(lines, lineNumber, ' atom types')\n\n  lineNumber = findNext(lines, lineNumber, ' xlo xhi', (line: string) => {\n    ;[xlo, xhi] = line.split(' ').map(parseFloat)\n  })\n\n  lineNumber = findNext(lines, lineNumber, ' ylo yhi', (line: string) => {\n    ;[ylo, yhi] = line.split(' ').map(parseFloat)\n  })\n\n  lineNumber = findNext(lines, lineNumber, ' zlo zhi', (line: string) => {\n    ;[zlo, zhi] = line.split(' ').map(parseFloat)\n  })\n\n  let xy = 0\n  let xz = 0\n  let yz = 0\n  if (lines[lineNumber + 1].includes('xy xz yz')) {\n    lineNumber = findNext(\n      lines,\n      lineNumber + 1,\n      ' xy xz yz',\n      (line: string) => {\n        ;[xy, xz, yz] = line.split(' ').map(parseFloat)\n      }\n    )\n  }\n\n  // Ignore other fields as Masses and Pair Coeffs etc\n  lineNumber = getNextLineNumber(lines, lineNumber, 'Atoms')\n  console.log(\n    `Found Atoms on line ${lineNumber - 1} which is line ${\n      lines[lineNumber - 1]\n    }`\n  )\n\n  let isMolecular = false\n  lineNumber = findNext(lines, lineNumber, 'Atoms', (line) => {\n    isMolecular = line.includes('molecular')\n  })\n  lineNumber++\n\n  const particles = new Particles(numAtoms)\n\n  while (lines[lineNumber].trim() === '') {\n    lineNumber++\n  }\n\n  if (isMolecular) {\n    parseMolecular(lines, lineNumber, particles)\n  } else {\n    parseAtomic(lines, lineNumber, particles)\n  }\n  const simulationCell = new SimulationCell(\n    new THREE.Vector3(xhi - xlo, 0, 0),\n    new THREE.Vector3(xy, yhi - ylo, 0),\n    new THREE.Vector3(xz, yz, zhi - zlo),\n    new THREE.Vector3(xlo, ylo, zlo)\n  )\n  const simulationDataFrame = new SimulationDataFrame(particles, simulationCell)\n  const simulationData = new SimulationData()\n  simulationData.frames.push(simulationDataFrame)\n  return simulationData\n}\n\nexport default parseLAMMPSData\n","/**\n * @file Binary Heap\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n/**\n * Binary heap implementation\n * @class\n * @author http://eloquentjavascript.net/appendix2.htm\n * @param {Function} scoreFunction - the heap scoring function\n */\nclass BinaryHeap<T> {\n  content: T[] = []\n\n  constructor(readonly scoreFunction: (x: T) => number) {\n    this.scoreFunction = scoreFunction\n  }\n\n  push(element: T) {\n    // Add the new element to the end of the array.\n    this.content.push(element)\n\n    // Allow it to bubble up.\n    this.bubbleUp(this.content.length - 1)\n  }\n\n  pop() {\n    // Store the first element so we can return it later.\n    const result = this.content[0]\n\n    // Get the element at the end of the array.\n    const end = this.content.pop()\n\n    // If there are any elements left, put the end element at the\n    // start, and let it sink down.\n    if (end && this.content.length > 0) {\n      this.content[0] = end\n      this.sinkDown(0)\n    }\n\n    return result\n  }\n\n  peek() {\n    return this.content[0]\n  }\n\n  remove(element: T) {\n    const len = this.content.length\n\n    // To remove a value, we must search through the array to find it.\n    for (let i = 0; i < len; i++) {\n      if (this.content[i] === element) {\n        // When it is found, the process seen in 'pop' is repeated\n        // to fill up the hole.\n        const end = this.content.pop()\n\n        if (end && i !== len - 1) {\n          this.content[i] = end\n\n          if (this.scoreFunction(end) < this.scoreFunction(element)) {\n            this.bubbleUp(i)\n          } else {\n            this.sinkDown(i)\n          }\n        }\n\n        return\n      }\n    }\n\n    throw new Error('Node not found.')\n  }\n\n  size() {\n    return this.content.length\n  }\n\n  bubbleUp(n: number) {\n    // Fetch the element that has to be moved.\n    const element = this.content[n]\n\n    // When at 0, an element can not go up any further.\n    while (n > 0) {\n      // Compute the parent element's index, and fetch it.\n      const parentN = Math.floor((n + 1) / 2) - 1\n      const parent = this.content[parentN]\n\n      // Swap the elements if the parent is greater.\n      if (this.scoreFunction(element) < this.scoreFunction(parent)) {\n        this.content[parentN] = element\n        this.content[n] = parent\n\n        // Update 'n' to continue at the new position.\n        n = parentN\n      } else {\n        // Found a parent that is less, no need to move it further.\n        break\n      }\n    }\n  }\n\n  sinkDown(n: number) {\n    // Look up the target element and its score.\n    const length = this.content.length\n    const element = this.content[n]\n    const elemScore = this.scoreFunction(element)\n\n    let child1Score = 0\n    let child2Score = 0\n\n    while (true) {\n      // Compute the indices of the child elements.\n      const child2N = (n + 1) * 2\n      const child1N = child2N - 1\n\n      // This is used to store the new position of the element, if any.\n      let swap = null\n\n      // If the first child exists (is inside the array)...\n      if (child1N < length) {\n        // Look it up and compute its score.\n        const child1 = this.content[child1N]\n        child1Score = this.scoreFunction(child1)\n\n        // If the score is less than our element's, we need to swap.\n        if (child1Score < elemScore) swap = child1N\n      }\n\n      // Do the same checks for the other child.\n      if (child2N < length) {\n        const child2 = this.content[child2N]\n        child2Score = this.scoreFunction(child2)\n\n        if (child2Score < (swap === null ? elemScore : child1Score))\n          swap = child2N\n      }\n\n      // If the element needs to be moved, swap it, and continue.\n      if (swap !== null) {\n        this.content[n] = this.content[swap]\n        this.content[swap] = element\n        n = swap\n      } else {\n        // Otherwise, we are done.\n        break\n      }\n    }\n  }\n}\n\nexport default BinaryHeap\n","/**\n * @file Kdtree\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport BinaryHeap from './binary-heap'\n\n/**\n * Kdtree\n * @class\n * @author Alexander Rose <alexander.rose@weirdbyte.de>, 2016\n * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013\n * @author I4DS http://www.fhnw.ch/i4ds, 2013\n * @license MIT License <http://www.opensource.org/licenses/mit-license.php>\n * @description\n * k-d Tree for typed arrays of 3d points (e.g. for Float32Array), in-place\n * provides fast nearest neighbour search\n *\n * Based on https://github.com/ubilabs/kd-tree-javascript by Ubilabs\n *\n * Further information (including mathematical properties)\n * http://en.wikipedia.org/wiki/Binary_tree\n * http://en.wikipedia.org/wiki/K-d_tree\n *\n * @example\n * points: [x, y, z, x, y, z, x, y, z, ...]\n * metric: function(a, b){\n *    return Math.pow(a[0]-b[0], 2) + Math.pow(a[1]-b[1], 2) + Math.pow(a[2]-b[2], 2);\n * }\n *\n * @param {Float32Array} points - points\n * @param {Function} metric - metric\n */\n\nconst reusableArray = new Float32Array(3)\n\nclass Kdtree {\n  indices: Uint32Array\n  nodes: Int32Array\n  rootIndex: number\n\n  maxDepth = 0\n  currentNode = 0\n\n  constructor(\n    readonly points: Float32Array,\n    readonly metric: (a: Float32Array, b: Float32Array) => number\n  ) {\n    const n = points.length / 3\n\n    const indices = new Uint32Array(n)\n    for (let i = 0; i < n; ++i) {\n      indices[i] = i\n    }\n    this.indices = indices\n    this.nodes = new Int32Array(n * 4)\n    this.rootIndex = this.buildTree(0, -1, 0, n)\n  }\n\n  buildTree(depth: number, parent: number, arrBegin: number, arrEnd: number) {\n    if (depth > this.maxDepth) this.maxDepth = depth\n\n    const plength = arrEnd - arrBegin\n    if (plength === 0) {\n      return -1\n    }\n\n    const nodeIndex = this.currentNode * 4\n    const nodes = this.nodes\n\n    this.currentNode += 1\n    if (plength === 1) {\n      nodes[nodeIndex] = arrBegin\n      nodes[nodeIndex + 1] = -1\n      nodes[nodeIndex + 2] = -1\n      nodes[nodeIndex + 3] = parent\n      return nodeIndex\n    }\n    // if(plength <= 32){\n    //   return nodeIndex;\n    // }\n\n    const indices = this.indices\n    const points = this.points\n\n    const arrMedian = arrBegin + Math.floor(plength / 2)\n    const currentDim = depth % 3\n\n    // inlined quickselect function\n    let j, tmp, pivotIndex, pivotValue, storeIndex\n    let left = arrBegin\n    let right = arrEnd - 1\n    while (right > left) {\n      pivotIndex = (left + right) >> 1\n      pivotValue = points[indices[pivotIndex] * 3 + currentDim]\n      // swap( pivotIndex, right );\n      tmp = indices[pivotIndex]\n      indices[pivotIndex] = indices[right]\n      indices[right] = tmp\n      storeIndex = left\n      for (j = left; j < right; ++j) {\n        if (points[indices[j] * 3 + currentDim] < pivotValue) {\n          // swap( storeIndex, j );\n          tmp = indices[storeIndex]\n          indices[storeIndex] = indices[j]\n          indices[j] = tmp\n          ++storeIndex\n        }\n      }\n      // swap( right, storeIndex );\n      tmp = indices[right]\n      indices[right] = indices[storeIndex]\n      indices[storeIndex] = tmp\n      pivotIndex = storeIndex\n      if (arrMedian === pivotIndex) {\n        break\n      } else if (arrMedian < pivotIndex) {\n        right = pivotIndex - 1\n      } else {\n        left = pivotIndex + 1\n      }\n    }\n\n    nodes[nodeIndex] = arrMedian\n    nodes[nodeIndex + 1] = this.buildTree(\n      depth + 1,\n      nodeIndex,\n      arrBegin,\n      arrMedian\n    )\n    nodes[nodeIndex + 2] = this.buildTree(\n      depth + 1,\n      nodeIndex,\n      arrMedian + 1,\n      arrEnd\n    )\n    nodes[nodeIndex + 3] = parent\n\n    return nodeIndex\n  }\n\n  getNodeDepth(nodeIndex: number): number {\n    const parentIndex = this.nodes[nodeIndex + 3]\n    return parentIndex === -1 ? 0 : this.getNodeDepth(parentIndex) + 1\n  }\n\n  // TODO\n  // function getNodePos (node) {}\n\n  /**\n   * find nearest points\n   * @param {Array} point - array of size 3\n   * @param {Integer} maxNodes - max amount of nodes to return\n   * @param {Float} maxDistance - maximum distance of point to result nodes\n   * @return {Array} array of point, distance pairs\n   */\n  nearest(point: Float32Array, maxNodes: number, maxDistance: number) {\n    const bestNodes = new BinaryHeap<[number, number]>((e) => -e[1])\n\n    const nodes = this.nodes\n    const points = this.points\n    const indices = this.indices\n\n    const nearestSearch = (nodeIndex: number) => {\n      let bestChild, otherChild\n      const dimension = this.getNodeDepth(nodeIndex) % 3\n      const pointIndex = indices[nodes[nodeIndex]] * 3\n      const ownPoint = points.subarray(pointIndex, pointIndex + 3)\n      const ownDistance = this.metric(point, ownPoint)\n\n      function saveNode(nodeIndex: number, distance: number) {\n        bestNodes.push([nodeIndex, distance])\n        if (bestNodes.size() > maxNodes) {\n          bestNodes.pop()\n        }\n      }\n\n      const leftIndex = nodes[nodeIndex + 1]\n      const rightIndex = nodes[nodeIndex + 2]\n\n      // if it's a leaf\n      if (rightIndex === -1 && leftIndex === -1) {\n        if (\n          (bestNodes.size() < maxNodes || ownDistance < bestNodes.peek()[1]) &&\n          ownDistance <= maxDistance\n        ) {\n          saveNode(nodeIndex, ownDistance)\n        }\n        return\n      }\n\n      if (rightIndex === -1) {\n        bestChild = leftIndex\n      } else if (leftIndex === -1) {\n        bestChild = rightIndex\n      } else {\n        if (point[dimension] <= points[pointIndex + dimension]) {\n          bestChild = leftIndex\n        } else {\n          bestChild = rightIndex\n        }\n      }\n\n      // recursive search\n      nearestSearch(bestChild)\n\n      if (\n        (bestNodes.size() < maxNodes || ownDistance < bestNodes.peek()[1]) &&\n        ownDistance <= maxDistance\n      ) {\n        saveNode(nodeIndex, ownDistance)\n      }\n\n      // if there's still room or the current distance is nearer than the best distance\n      const linearPoint = reusableArray\n      for (let i = 0; i < 3; i += 1) {\n        if (i === dimension) {\n          linearPoint[i] = point[i]\n        } else {\n          linearPoint[i] = points[pointIndex + i]\n        }\n      }\n      const linearDistance = this.metric(linearPoint, ownPoint)\n\n      if (\n        (bestNodes.size() < maxNodes ||\n          Math.abs(linearDistance) < bestNodes.peek()[1]) &&\n        Math.abs(linearDistance) <= maxDistance\n      ) {\n        if (bestChild === leftIndex) {\n          otherChild = rightIndex\n        } else {\n          otherChild = leftIndex\n        }\n        if (otherChild !== -1) {\n          nearestSearch(otherChild)\n        }\n      }\n    }\n\n    nearestSearch(this.rootIndex)\n\n    const result = []\n    for (let i = 0, il = Math.min(bestNodes.size(), maxNodes); i < il; i += 1) {\n      result.push(bestNodes.content[i])\n    }\n\n    return result\n  }\n\n  verify(nodeIndex?: number, depth = 0) {\n    let count = 1\n\n    if (nodeIndex === undefined) {\n      nodeIndex = this.rootIndex\n    }\n\n    if (nodeIndex === -1) {\n      throw new Error('node is null')\n    }\n\n    const dim = depth % 3\n    const nodes = this.nodes\n    const points = this.points\n    const indices = this.indices\n\n    const leftIndex = nodes[nodeIndex + 1]\n    const rightIndex = nodes[nodeIndex + 2]\n\n    if (leftIndex !== -1) {\n      if (\n        points[indices[nodes[leftIndex]] * 3 + dim] >\n        points[indices[nodes[nodeIndex]] * 3 + dim]\n      ) {\n        throw new Error('left child is > parent!')\n      }\n      count += this.verify(leftIndex, depth + 1)\n    }\n\n    if (rightIndex !== -1) {\n      if (\n        points[indices[nodes[rightIndex]] * 3 + dim] <\n        points[indices[nodes[nodeIndex]] * 3 + dim]\n      ) {\n        throw new Error('right child is < parent!')\n      }\n      count += this.verify(rightIndex, depth + 1)\n    }\n\n    return count\n  }\n}\n\nexport default Kdtree\n","import SimulationDataFrame from 'core/simulationdata/simulationdataframe'\nimport Kdtree from './kdtree/kdtree'\nimport Bonds from 'core/geometries/bonds/bonds'\n\ntype CreateBondsByDistanceOptions = {\n  radius: number\n  pairDistances: { type1: string; type2: string; distance: number }[]\n}\n\nconst createBondsByDistance = ({\n  radius = 0.5,\n  pairDistances = []\n}: CreateBondsByDistanceOptions) => {\n  return (frame: SimulationDataFrame) => {\n    const particles = frame.particles\n    const distance = (a: Float32Array, b: Float32Array) => {\n      return (\n        Math.pow(a[0] - b[0], 2) +\n        Math.pow(a[1] - b[1], 2) +\n        Math.pow(a[2] - b[2], 2)\n      )\n    }\n\n    // Create map so we can do lookups like pairDistancesMap[\"H\"][\"O\"] to find 1.4\n    const pairDistancesMap: { [key: string]: { [key: string]: number } } = {}\n    pairDistances.forEach((pairDistance) => {\n      if (pairDistancesMap[pairDistance.type1] == null) {\n        pairDistancesMap[pairDistance.type1] = {}\n      }\n      if (pairDistancesMap[pairDistance.type2] == null) {\n        pairDistancesMap[pairDistance.type2] = {}\n      }\n\n      pairDistancesMap[pairDistance.type1][pairDistance.type2] =\n        pairDistance.distance\n      pairDistancesMap[pairDistance.type2][pairDistance.type1] =\n        pairDistance.distance\n    })\n    const pairs: { [key: string]: boolean } = {}\n\n    var tree = new Kdtree(\n      particles.positions.subarray(0, 3 * particles.count),\n      distance\n    )\n\n    const position1: THREE.Vector3[] = []\n    const position2: THREE.Vector3[] = []\n\n    for (let i = 0; i < particles.count; i++) {\n      const particle1Type = particles.getType(i)\n      if (pairDistancesMap[particle1Type] == null) {\n        // We have no bonds for this particle type\n        continue\n      }\n      const nearest = tree.nearest(\n        particles.positions.subarray(3 * i, 3 * (i + 1)),\n        4,\n        1.4\n      )\n      for (let j = 0; j < nearest.length; j++) {\n        const nodeIndex = nearest[j][0]\n        const index = tree.indices[tree.nodes[nodeIndex]]\n        if (index === i) {\n          // Skip ourselves, as we always will find that with distance zero\n          continue\n        }\n\n        const particle2Type = particles.getType(index)\n\n        if (pairDistancesMap[particle1Type][particle2Type] == null) {\n          // We have no bonds for this pair of particle types\n          continue\n        }\n\n        const distanceThreshold = pairDistancesMap[particle1Type][particle2Type]\n        const distance = nearest[j][1]\n        if (distance > distanceThreshold) {\n          // Particle pair is too far away\n          continue\n        }\n        const pairKey = index < i ? `${index}-${i}` : `${i}-${index}`\n\n        if (pairs[pairKey] == null) {\n          position1.push(particles.getPosition(i))\n          position2.push(particles.getPosition(index))\n          pairs[pairKey] = true\n        }\n      }\n    }\n\n    const bonds = new Bonds(position1.length)\n    for (let i = 0; i < position1.length; i++) {\n      bonds.add(\n        position1[i].x,\n        position1[i].y,\n        position1[i].z,\n        position2[i].x,\n        position2[i].y,\n        position2[i].z,\n        radius\n      )\n    }\n\n    return bonds\n  }\n}\n\nexport { createBondsByDistance }\n"],"sourceRoot":""}